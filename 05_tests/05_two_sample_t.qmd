---
title: "Two-sample t-Methods"
author: "David Gerard"
format: html
date: today
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
            fig.width = 4, 
            fig.height = 3, 
            fig.align = "center")
ggplot2::theme_set(ggplot2::theme_bw() + ggplot2::theme(strip.background = ggplot2::element_rect(fill = "white")))
```

```{r}
#| message: false
library(tidyverse)
library(broom)
```


# Paired $t$-tests

- Data from 10 women containt eh systolic blood pressure (SBP) (in mm Hg) before and while using an oral contraceptive. 

  ```{r}
  oc_df <- data.frame(
    pre_sbp = c(115, 112, 107, 119, 115, 138, 126, 105, 104, 115),
    post_sbp = c(128, 115, 106, 128, 122, 145, 132, 109, 102, 117)
  )
  ```

- We use `t.test()` to run a paired $t$-test.
    - `x`: The first column.
    - `y`: The second column. 
    - `paired`: set to `TRUE` to make it a paired $t$-test.

  ```{r}
  t.test(x = oc_df$post_sbp, y = oc_df$pre_sbp, paired = TRUE) |>
    tidy()
  ```

- This is the exact same as just first calculating the differences then running a one-sample $t$-test.

  ```{r}
  oc_df <- mutate(oc_df, diff = post_sbp - pre_sbp)
  t.test(diff ~ 1, data = oc_df) |>
    tidy()
  ```

- Notice that the paired $t$-test uses `x - y`, not `y - x`, as the vector of differences.

- Our conclusion might read like this:

    > We have strong evidence that women who use an oral contraceptive (OC) have a different mean systolic blood pressure (SBP) than women  who do not use an OC ($p$ = 0.008874, $n$ = 10). We estimate that women who use an OC have on average an SBP 4.8 mm Hg higher than women who do not use an OC (95% CI 1.534 mm Hg to 8.066 mm Hg higher).

- **Exercise**: A study included 15 twins where one has schizophrenia and the other does not. These data contain the volume (in cm$^3$) of the left hippocampus of each twin. These data are from *The Statistical Sleuth*, which in turn obtained the data from [doi:10.1056/NEJM199003223221201](https://www.doi.org/10.1056/NEJM199003223221201). Evaluate if there are any physical differences between the twins. Also, provide an interval estimate on the mean difference in volume between twin-types. Do this in two ways (i) by using `t.test()` and (ii) "by hand" after calculating the appropriate summary statistics. 

  ```{r}
  sc_df <- data.frame(
    Unaffected = c(1.94, 1.44, 1.56, 1.58, 2.06, 1.66, 1.75, 1.77, 
                   1.78, 1.92, 1.25, 1.93, 2.04, 1.62, 2.08), 
    Affected = c(1.27, 1.63, 1.47, 1.39, 1.93, 1.26, 1.71, 1.67, 
                 1.28, 1.85, 1.02, 1.34, 2.02, 1.59, 1.97)
  )
  ```


```{r}
#| eval: false
#| echo: false
t.test(x = sc_df$Affected, y = sc_df$Unaffected, paired = TRUE) |>
  tidy()
```

```{block}
#| eval: false
#| echo: false
We have strong evidence of a difference in mean volume between the twin types ($p$ = 0.00602, n = 15). We estimate that the unaffected twin has on average 0.2 cm$^3$ larger hippocampus than the affected twin (95% CI 0.0667 cm$^3$ to 0.3306 cm$^3$ larger).
```

```{r}
#| eval: false
#| echo: false
sc_df <- mutate(sc_df, diff = Affected - Unaffected)
xbar <- mean(sc_df$diff)
s <- sd(sc_df$diff)
n <- nrow(sc_df)
t <- xbar / (s / sqrt(n))
p_value <- 2 * pt(-abs(t), df = n - 1)
lower <- xbar - qt(p = 0.975, df = n - 1) * s / sqrt(n)
upper <- xbar + qt(p = 0.975, df = n - 1) * s / sqrt(n)
c(p_value, lower, upper)
```   


